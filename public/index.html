<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-visual">
  <meta name="theme-color" content="#0D0D0D">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>RAI</title>

  <link rel="icon"
    href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64"><defs><linearGradient id="planetGrad" x1="0%%" y1="0%%" x2="100%%" y2="100%%"><stop offset="0%%" style="stop-color:%23f5d547;stop-opacity:1"/><stop offset="100%%" style="stop-color:%23e6a824;stop-opacity:1"/></linearGradient><linearGradient id="ringGrad" x1="0%%" y1="100%%" x2="100%%" y2="0%%"><stop offset="0%%" style="stop-color:%23f9e79f;stop-opacity:1"/><stop offset="100%%" style="stop-color:%23fef5e7;stop-opacity:1"/></linearGradient></defs><circle cx="32" cy="32" r="14" fill="url(%23planetGrad)"/><path d="M 10 42 C 10 35, 54 20, 54 28 C 54 32, 40 40, 32 40" fill="none" stroke="url(%23ringGrad)" stroke-width="4" stroke-linecap="round" opacity="0.8"/><path d="M 54 28 C 54 36, 10 50, 10 42" fill="none" stroke="url(%23ringGrad)" stroke-width="4" stroke-linecap="round" opacity="0.9"/><circle cx="26" cy="26" r="4" fill="white" opacity="0.2"/></svg>'
    type="image/svg+xml">

  <!-- Marked.js for Markdown Rendering -->
  <script src="lib/marked.min.js"></script>

  <!-- KaTeX for Math Rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    crossorigin="anonymous"></script>

  <!-- Mermaid.js 图表渲染 -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>

  <!-- Highlight.js 代码语法高亮 -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css">
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>

  <!-- 外部样式表 -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <!-- 登录/注册界面 - Apple风格渐进式输入 -->
  <div class="auth-container active" id="authContainer">
    <div class="auth-box">
      <div class="auth-logo">
        <div class="auth-logo-text">RAI</div>
      </div>

      <!-- 统一的邮箱输入步骤 -->
      <div id="emailStep">
        <h2 class="auth-title" id="authTitle" data-i18n="login-title">欢迎回来</h2>
        <p class="auth-subtitle" id="authSubtitle" data-i18n="login-subtitle">登录继续使用 RAI</p>

        <div class="error-message" id="authError"></div>

        <div class="auth-form">
          <div class="form-group">
            <label class="form-label" data-i18n="email-label">邮箱</label>
            <input type="email" class="form-input" id="authEmail" placeholder="your@email.com"
              oninput="handleEmailInput(this)" onkeydown="handleEmailKeydown(event)" required autocomplete="email">
          </div>

          <!-- 密码区域 - 初始隐藏 -->
          <div class="form-group auth-step-hidden" id="passwordStep">
            <label class="form-label" data-i18n="password-label">密码</label>
            <input type="password" class="form-input" id="authPassword" data-i18n-placeholder="password-placeholder"
              placeholder="至少6位字符" onkeydown="handlePasswordKeydown(event)" autocomplete="current-password">
          </div>

          <!-- 用户名区域 - 仅注册时显示 -->
          <div class="form-group auth-step-hidden" id="usernameStep">
            <label class="form-label" data-i18n="username-label">用户名 (可选)</label>
            <input type="text" class="form-input" id="authUsername" data-i18n-placeholder="username-placeholder"
              placeholder="您的昵称" autocomplete="username">
          </div>

          <!-- 提交按钮 - 初始隐藏 -->
          <div class="auth-step-hidden" id="submitStep">
            <button type="button" class="auth-btn" id="authSubmitBtn" onclick="handleAuthSubmit()"
              data-i18n="login-btn">登录</button>
          </div>
        </div>

        <!-- 登录/注册切换 和 语言切换 - 放到表单下方 -->
        <div class="auth-footer">
          <div class="auth-switch" id="authSwitch">
            <span data-i18n="no-account">还没有账号?</span>
            <a class="auth-link" onclick="switchAuthMode()" id="authSwitchLink" data-i18n="register-link">立即注册</a>
          </div>
          <button class="auth-lang-btn-inline" onclick="toggleLanguage()" title="Switch Language / 切换语言">
            <span id="authLangText">EN</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 主应用容器 -->
  <div class="app-container" id="appContainer" style="display: none;">
    <!-- 移动端头部 -->
    <div class="mobile-header" id="mobileHeader">
      <button class="hamburger-btn" onclick="toggleSidebar()">
        <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
          height="24" fill="currentColor">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
        </svg>
      </button>
      <div class="mobile-logo">RAI</div>
      <div class="header-controls">
        <button class="control-btn" onclick="toggleTheme()" title="切换主题">
          <svg class="material-symbols-outlined" id="mobileThemeIcon" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
            <path
              d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" />
          </svg>
        </button>
        <button class="control-btn" onclick="toggleLanguage()" title="切换语言">
          <span id="mobileLangText" style="font-size: 14px; font-weight: 600;">EN</span>
        </button>
      </div>
    </div>

    <div class="mobile-overlay" id="mobileOverlay" onclick="toggleSidebar()"></div>

    <!-- 侧边栏 -->
    <div class="sidebar" id="sidebar">
      <!-- 固定顶部区域 -->
      <div class="sidebar-header-fixed">
        <div class="sidebar-header-top">
          <div class="logo-section">
            <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="32" height="32">
              <defs>
                <linearGradient id="planetGradLogo" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#f5d547;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#e6a824;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="ringGradLogo" x1="0%" y1="100%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#f9e79f;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#fef5e7;stop-opacity:1" />
                </linearGradient>
              </defs>
              <circle cx="32" cy="32" r="14" fill="url(#planetGradLogo)" />
              <path d="M 10 42 C 10 35, 54 20, 54 28 C 54 32, 40 40, 32 40" fill="none" stroke="url(#ringGradLogo)"
                stroke-width="4" stroke-linecap="round" opacity="0.8" />
              <path d="M 54 28 C 54 36, 10 50, 10 42" fill="none" stroke="url(#ringGradLogo)" stroke-width="4"
                stroke-linecap="round" opacity="0.9" />
              <circle cx="26" cy="26" r="4" fill="white" opacity="0.2" />
            </svg>
            <div class="logo-text-col">
              <div class="logo">RAI</div>
              <div class="logo-subtitle">by Rick · v0.85+</div>
            </div>
          </div>
          <div class="sidebar-header-controls">
            <button class="sidebar-control-btn" onclick="toggleTheme()" title="切换主题">
              <svg class="material-symbols-outlined" id="sidebarThemeIcon" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path
                  d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" />
              </svg>
            </button>
            <button class="sidebar-control-btn" onclick="toggleLanguage()" title="切换语言">
              <span class="sidebar-lang-text" id="sidebarLangText">EN</span>
            </button>
          </div>
        </div>

        <div class="search-box">
          <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
            height="24" fill="currentColor">
            <path
              d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
          </svg>
          <input type="text" data-i18n-placeholder="search-placeholder" placeholder="搜索对话" id="searchInput"
            oninput="handleSearch(this.value)">
        </div>

        <button class="new-chat-btn" onclick="createNewSession()">
          <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
            height="24" fill="currentColor">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
          </svg>
          <span data-i18n="new-chat">新对话</span>
        </button>
      </div>

      <!-- 可滚动中间区域 - 带边缘羽化效果 -->
      <div class="sidebar-scrollable-wrapper">
        <div class="sidebar-edge-blur-top"></div>
        <div class="sidebar-scrollable">
          <!-- 空间分组 (暂时隐藏) -->
          <div class="sidebar-group" style="display: none;">
            <div class="sidebar-group-header" onclick="toggleGroup('spaces')">
              <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
                height="24" fill="currentColor">
                <path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z" />
              </svg>
              <span class="sidebar-group-title" data-i18n="sidebar-spaces">空间</span>
              <svg class="material-symbols-outlined group-toggle-icon" id="spacesToggle"
                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
              </svg>
            </div>
            <div class="sidebar-group-content" id="spacesGroup">
              <button class="new-space-btn-inline" onclick="createNewSpace()">
                <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
                  height="24" fill="currentColor">
                  <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                </svg>
                <span data-i18n="new-space">新建空间</span>
              </button>
              <div class="spaces-list" id="spacesList"></div>
            </div>
          </div>

          <!-- Chat Flow 思维流分组 -->
          <div class="sidebar-group">
            <div class="sidebar-group-header" onclick="toggleGroup('flows')">
              <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                width="24" height="24" fill="currentColor">
                <path
                  d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm40-80h200v-80H240v80Zm280 0h160v-80H520v80ZM240-440h160v-80H240v80Zm200 0h280v-80H440v80ZM240-600h280v-80H240v80Zm320 0h160v-80H560v80Z" />
              </svg>
              <span class="sidebar-group-title" data-i18n="sidebar-flows">思维流</span>
              <svg class="material-symbols-outlined group-toggle-icon" id="flowsToggle"
                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
              </svg>
            </div>
            <div class="sidebar-group-content" id="flowsGroup">
              <button class="new-flow-btn-inline" onclick="createNewFlow()">
                <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
                  height="24" fill="currentColor">
                  <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                </svg>
                <span data-i18n="new-flow">新建思维流</span>
              </button>
              <div class="flows-list" id="flowsList"></div>
            </div>
          </div>

          <!-- 对话分组 -->
          <div class="sidebar-group">
            <div class="sidebar-group-header" onclick="toggleGroup('sessions')">
              <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
                height="24" fill="currentColor">
                <path
                  d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z" />
              </svg>
              <span class="sidebar-group-title" data-i18n="sidebar-sessions">对话</span>
              <svg class="material-symbols-outlined group-toggle-icon" id="sessionsToggle"
                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
              </svg>
            </div>
            <div class="sidebar-group-content" id="sessionsGroup">
              <div class="sessions-container" id="sessionsContainer"></div>
            </div>
          </div>
        </div>
        <div class="sidebar-edge-blur-bottom"></div>
      </div>

      <!-- 固定底部区域 -->
      <div class="sidebar-footer-fixed">
        <div class="user-section" id="userSection">
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-info-group">
            <div class="user-info-top">
              <div class="user-name" id="userName">用户</div>
              <button class="settings-btn-inline" onclick="openSettings()" title="设置">
                <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
                  height="24" fill="currentColor">
                  <path
                    d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                </svg>
              </button>
            </div>
            <!-- 签到按钮容器 - 只在可签到时显示 -->
            <div id="sidebarCheckinContainer" style="display:none;"></div>
          </div>
        </div>
      </div>
    </div>


    <!-- 主内容区 -->
    <div class="main-content">
      <!-- 边缘模糊层（叠加在渐变之上） -->
      <div class="chat-edge-blur-top"></div>
      <div class="chat-edge-blur-bottom"></div>
      <div class="chat-container" id="chatContainer">
        <div class="welcome-screen" id="welcomeScreen">
          <div class="welcome-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="96" height="96">
              <defs>
                <linearGradient id="planetGradWelcome" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#f5d547;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#e6a824;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="ringGradWelcome" x1="0%" y1="100%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#f9e79f;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#fef5e7;stop-opacity:1" />
                </linearGradient>
              </defs>
              <circle cx="32" cy="32" r="14" fill="url(#planetGradWelcome)" />
              <path d="M 10 42 C 10 35, 54 20, 54 28 C 54 32, 40 40, 32 40" fill="none" stroke="url(#ringGradWelcome)"
                stroke-width="4" stroke-linecap="round" opacity="0.8" />
              <path d="M 54 28 C 54 36, 10 50, 10 42" fill="none" stroke="url(#ringGradWelcome)" stroke-width="4"
                stroke-linecap="round" opacity="0.9" />
              <circle cx="26" cy="26" r="4" fill="white" opacity="0.2" />
            </svg>
          </div>
          <h1 class="welcome-title" data-i18n="welcome-title">How can I help you? ✨</h1>

          <div class="welcome-actions">
            <div class="action-card" onclick="handleActionCard('write')">
              <svg class="material-symbols-outlined action-card-icon" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path
                  d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
              </svg>
              <span class="action-card-title" data-i18n="action-write">写作</span>
            </div>

            <div class="action-card" onclick="handleActionCard('search')">
              <svg class="material-symbols-outlined action-card-icon" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path
                  d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
              </svg>
              <span class="action-card-title" data-i18n="action-search">搜索</span>
            </div>

            <div class="action-card" onclick="handleActionCard('code')">
              <svg class="material-symbols-outlined action-card-icon" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" />
              </svg>
              <span class="action-card-title" data-i18n="action-code">代码</span>
            </div>

            <div class="action-card" onclick="handleActionCard('translate')">
              <svg class="material-symbols-outlined action-card-icon" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path
                  d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z" />
              </svg>
              <span class="action-card-title" data-i18n="action-translate">翻译</span>
            </div>
          </div>
        </div>

        <div class="messages-list" id="messagesList" style="display: none;">
        </div>
      </div>

      <!-- 输入区域 -->
      <div class="input-area">
        <div class="input-wrapper">
          <div class="input-container" id="inputContainer">
            <!-- 顶部输入行 -->
            <div class="input-row">
              <textarea class="message-input" id="messageInput" data-i18n-placeholder="input-placeholder"
                placeholder="询问问题..." rows="1" inputmode="text" autocomplete="off" autocorrect="off"
                autocapitalize="sentences" onkeydown="handleInputKeydown(event)" oninput="autoResizeInput()"></textarea>
            </div>

            <!-- 底部工具栏 -->
            <div class="input-toolbar">
              <!-- 更多菜单 -->
              <div class="more-menu-container">
                <button class="toolbar-btn" id="moreBtn" onclick="toggleMoreMenu()">
                  <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                    width="20" height="20" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" stroke="currentColor" stroke-width="0.5" />
                  </svg>
                </button>

                <!-- 更多菜单下拉 -->
                <div class="more-menu" id="moreMenu">
                  <!-- 联网搜索开关 -->
                  <div class="more-menu-item" onclick="toggleInternetFromMenu(event)">
                    <div class="more-menu-item-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                          d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.91-4.33-3.56zm2.95-8H5.08c.96-1.65 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z" />
                      </svg>
                    </div>
                    <span class="more-menu-item-text" data-i18n="internet-search">联网搜索</span>
                    <div class="more-menu-item-toggle" id="internetToggle"></div>
                  </div>

                  <!-- 推理模式开关 -->
                  <div class="more-menu-item" onclick="toggleThinkingFromMenu(event)">
                    <div class="more-menu-item-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
                        <path
                          d="M240-80v-172q-57-52-88.5-121.5T120-520q0-150 105-255t255-105q125 0 221.5 73.5T827-615l52 205q5 19-7 34.5T840-360h-80v120q0 33-23.5 56.5T680-160h-80v80h-80v-160h160v-200h108l-38-155q-23-91-98-148t-172-57q-116 0-198 81t-82 197q0 60 24.5 114t69.5 96l26 24v208h-80Zm254-360Zm-54 80h80l6-50q8-3 14.5-7t11.5-9l46 20 40-68-40-30q2-8 2-16t-2-16l40-30-40-68-46 20q-5-5-11.5-9t-14.5-7l-6-50h-80l-6 50q-8 3-14.5 7t-11.5 9l-46-20-40 68 40 30q-2 8-2 16t2 16l-40 30 40 68 46-20q5 5 11.5 9t14.5 7l6 50Zm40-100q-25 0-42.5-17.5T420-520q0-25 17.5-42.5T480-580q25 0 42.5 17.5T540-520q0 25-17.5 42.5T480-460Z" />
                      </svg>
                    </div>
                    <span class="more-menu-item-text" data-i18n="reasoning-mode">推理模式</span>
                    <div class="more-menu-item-toggle" id="thinkingToggle"></div>
                  </div>

                  <div class="more-menu-divider"></div>

                  <!-- 添加附件 -->
                  <div class="more-menu-item" onclick="handleFileUploadFromMenu()">
                    <div class="more-menu-item-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                          d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z" />
                      </svg>
                    </div>
                    <span class="more-menu-item-text" data-i18n="add-attachment">添加附件</span>
                  </div>
                </div>
              </div>

              <!-- 思考预算弹窗 (保留，用于推理模式) -->
              <div class="thinking-budget-modal" id="thinkingBudgetModal" style="display: none;">
                <div class="thinking-budget-content">
                  <div class="thinking-budget-header">
                    <span class="thinking-budget-title" data-i18n="thinking-budget">思考预算</span>
                    <span class="thinking-budget-value" id="thinkingBudgetValue">1024 tokens</span>
                  </div>
                  <div class="thinking-budget-description" data-i18n="thinking-budget-desc">控制思考的最大长度</div>
                  <div class="thinking-budget-slider-container">
                    <span class="thinking-budget-label" data-i18n="min">最小</span>
                    <input type="range" class="thinking-budget-slider" id="thinkingBudgetSlider" min="1" max="32768"
                      step="256" value="1024" oninput="updateThinkingBudget(this.value)">
                    <span class="thinking-budget-label" data-i18n="max">最大</span>
                  </div>
                </div>
              </div>

              <!-- 右侧发送按钮 -->

              <div class="toolbar-spacer"></div>

              <!-- 自定义模型选择器 -->
              <div class="model-selector">
                <div class="model-select-custom" id="modelSelectCustom" onclick="openModelModal()">
                  <span id="selectedModelText">Kimi K2</span>
                  <svg class="material-symbols-outlined model-select-arrow" xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" />
                  </svg>
                </div>

                <!-- Grok风格下拉菜单 -->
                <div class="model-dropdown-menu" id="modelDropdownMenu">
                  <!-- 智能模式 -->
                  <div class="model-menu-item" data-model="auto"
                    onclick="selectModelFromMenu('auto', '智能模式', 'model-smart')">
                    <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" height="24px"
                      viewBox="0 -960 960 960" width="24px" fill="currentColor">
                      <path
                        d="M80-140v-320h320v320H80Zm80-80h160v-160H160v160Zm60-340 220-360 220 360H220Zm142-80h156l-78-126-78 126ZM863-42 757-148q-21 14-45.5 21t-51.5 7q-75 0-127.5-52.5T480-300q0-75 52.5-127.5T660-480q75 0 127.5 52.5T840-300q0 26-7 50.5T813-204L919-98l-56 56ZM660-200q42 0 71-29t29-71q0-42-29-71t-71-29q-42 0-71 29t-29 71q0 42 29 71t71 29ZM320-380Zm120-260Z" />
                    </svg>
                    <div class="model-menu-content">
                      <div class="model-menu-title" data-i18n="model-smart">智能模式</div>
                    </div>
                  </div>

                  <div class="model-menu-divider"></div>

                  <!-- 极速模式 -->
                  <div class="model-menu-item" data-model="qwen-flash"
                    onclick="selectModelFromMenu('qwen-flash', '极速模式', 'model-fast')">
                    <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" height="24px"
                      viewBox="0 -960 960 960" width="24px" fill="currentColor">
                      <path
                        d="m226-559 78 33q14-28 29-54t33-52l-56-11-84 84Zm142 83 114 113q42-16 90-49t90-75q70-70 109.5-155.5T806-800q-72-5-158 34.5T492-656q-42 42-75 90t-49 90Zm178-65q-23-23-23-56.5t23-56.5q23-23 57-23t57 23q23 23 23 56.5T660-541q-23 23-57 23t-57-23Zm19 321 84-84-11-56q-26 18-52 32.5T532-299l33 79Zm313-653q19 121-23.5 235.5T708-419l20 99q4 20-2 39t-20 33L538-80l-84-197-171-171-197-84 167-168q14-14 33.5-20t39.5-2l99 20q104-104 218-147t235-24ZM157-321q35-35 85.5-35.5T328-322q35 35 34.5 85.5T327-151q-25 25-83.5 43T82-76q14-103 32-161.5t43-83.5Zm57 56q-10 10-20 36.5T180-175q27-4 53.5-13.5T270-208q12-12 13-29t-11-29q-12-12-29-11.5T214-265Z" />
                    </svg>
                    <div class="model-menu-content">
                      <div class="model-menu-title" data-i18n="model-fast">极速模式</div>
                    </div>
                  </div>

                  <div class="model-menu-divider"></div>

                  <!-- 专家模式 -->
                  <div class="model-menu-item" data-model="qwen-max"
                    onclick="selectModelFromMenu('qwen-max', '专家模式', 'model-expert')">
                    <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" height="24px"
                      viewBox="0 -960 960 960" width="24px" fill="currentColor">
                      <path
                        d="M480-80q-26 0-47-12.5T400-126q-33 0-56.5-23.5T320-206v-142q-59-39-94.5-103T190-590q0-121 84.5-205.5T480-880q121 0 205.5 84.5T770-590q0 77-35.5 140T640-348v142q0 33-23.5 56.5T560-126q-12 21-33 33.5T480-80Zm-80-126h160v-36H400v36Zm0-76h160v-38H400v38Zm-8-118h58v-108l-88-88 42-42 76 76 76-76 42 42-88 88v108h58q54-26 88-76.5T690-590q0-88-61-149t-149-61q-88 0-149 61t-61 149q0 63 34 113.5t88 76.5Zm88-162Zm0-38Z" />
                    </svg>
                    <div class="model-menu-content">
                      <div class="model-menu-title" data-i18n="model-expert">专家模式</div>
                    </div>
                  </div>

                  <div class="model-menu-divider"></div>

                  <!-- 全部模型 (Expandable) -->
                  <div class="model-menu-item" data-toggle="all-models" onclick="toggleAllModels()">
                    <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" height="24px"
                      viewBox="0 -960 960 960" width="24px" fill="currentColor">
                      <path
                        d="M120-240v-80h520v80H120Zm664-40L584-480l200-200 56 56-144 144 144 144-56 56ZM120-440v-80h400v80H120Zm0-200v-80h520v80H120Z" />
                    </svg>
                    <div class="model-menu-content">
                      <div class="model-menu-title" data-i18n="model-all">全部模型</div>
                    </div>
                    <svg class="model-menu-arrow" id="allModelsArrow" xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                      <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" />
                    </svg>
                  </div>

                  <!-- 全部模型展开内容 -->
                  <div class="all-models-section" id="allModelsSection" style="display: none;">
                    <div class="model-menu-divider"></div>

                    <div class="model-menu-item" data-model="qwen-flash"
                      onclick="selectModelFromMenu('qwen-flash', 'Qwen Flash')">
                      <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                        fill="currentColor">
                        <path d="m280-80 160-300-320-40 480-460h80L520-580l320 40L360-80h-80Z" />
                      </svg>
                      <div class="model-menu-content">
                        <div class="model-menu-title">Qwen Flash</div>
                      </div>
                    </div>

                    <div class="model-menu-divider"></div>

                    <div class="model-menu-item" data-model="qwen-plus"
                      onclick="selectModelFromMenu('qwen-plus', 'Qwen Plus')">
                      <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                        fill="currentColor">
                        <path d="M479-160 280-360l51-52 148 148 318-318 51 52-369 370Z" />
                      </svg>
                      <div class="model-menu-content">
                        <div class="model-menu-title">Qwen Plus</div>
                      </div>
                    </div>

                    <div class="model-menu-divider"></div>

                    <div class="model-menu-item" data-model="qwen-max"
                      onclick="selectModelFromMenu('qwen-max', 'Qwen Max')">
                      <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                        fill="currentColor">
                        <path
                          d="M240-80v-172q-57-52-88.5-121.5T120-520q0-150 105-255t255-105q125 0 221.5 73.5T827-615l52 205q5 19-7 34.5T840-360h-80v120q0 33-23.5 56.5T680-160h-80v80h-80v-160h160v-200h108l-38-155q-23-91-98-148t-172-57q-116 0-198 81t-82 197q0 60 24.5 114t69.5 96l26 24v208h-80Z" />
                      </svg>
                      <div class="model-menu-content">
                        <div class="model-menu-title">Qwen Max</div>
                      </div>
                    </div>

                    <div class="model-menu-divider"></div>

                    <div class="model-menu-item" data-model="deepseek-v3"
                      onclick="selectModelFromMenu('deepseek-v3', 'DeepSeek V3.2')">
                      <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                        fill="currentColor">
                        <path
                          d="M320-280q17 0 28.5-11.5T360-320q0-17-11.5-28.5T320-360q-17 0-28.5 11.5T280-320q0 17 11.5 28.5T320-280Zm0-160q17 0 28.5-11.5T360-480q0-17-11.5-28.5T320-520q-17 0-28.5 11.5T280-480q0 17 11.5 28.5T320-440Zm0-160q17 0 28.5-11.5T360-640q0-17-11.5-28.5T320-680q-17 0-28.5 11.5T280-640q0 17 11.5 28.5T320-600Zm120 320h240v-80H440v80Zm0-160h240v-80H440v80Zm0-160h240v-80H440v80ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Z" />
                      </svg>
                      <div class="model-menu-content">
                        <div class="model-menu-title">DeepSeek V3.2</div>
                      </div>
                    </div>

                    <!-- DeepSeek Speciale 已隐藏 (临时模型已过期) -->

                    <div class="model-menu-divider"></div>

                    <!-- Kimi K2 -->
                    <div class="model-menu-item" data-model="kimi-k2"
                      onclick="selectModelFromMenu('kimi-k2', 'Kimi K2')">
                      <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                        fill="currentColor">
                        <path
                          d="m226-559 78 33q14-28 29-54t33-52l-56-11-84 84Zm142 83 114 113q42-16 90-49t90-75q70-70 109.5-155.5T806-800q-72-5-158 34.5T492-656q-42 42-75 90t-49 90Zm178-65q-23-23-23-56.5t23-56.5q23-23 57-23t57 23q23 23 23 56.5T660-541q-23 23-57 23t-57-23Zm19 321 84-84-11-56q-26 18-52 32.5T532-299l33 79Zm313-653q19 121-23.5 235.5T708-419l20 99q4 20-2 39t-20 33L538-80l-84-197-171-171-197-84 167-168q14-14 33.5-20t39.5-2l99 20q104-104 218-147t235-24ZM157-321q35-35 85.5-35.5T328-322q35 35 34.5 85.5T327-151q-25 25-83.5 43T82-76q14-103 32-161.5t43-83.5Zm57 56q-10 10-20 36.5T180-175q27-4 53.5-13.5T270-208q12-12 13-29t-11-29q-12-12-29-11.5T214-265Z" />
                      </svg>
                      <div class="model-menu-content">
                        <div class="model-menu-title">Kimi K2</div>
                      </div>
                    </div>

                    <div class="model-menu-divider"></div>

                    <!-- Qwen3-8B 免费模型 -->
                    <div class="model-menu-item" data-model="qwen3-8b"
                      onclick="selectModelFromMenu('qwen3-8b', 'Qwen3 8B')">
                      <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                        fill="currentColor">
                        <path
                          d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm-40-200v-100h-100v-80h100v-100h80v100h100v80h-100v100h-80Z" />
                      </svg>
                      <div class="model-menu-content">
                        <div class="model-menu-title">Qwen3 8B <span class="model-badge free">免费</span></div>
                      </div>
                    </div>

                    <div class="model-menu-divider"></div>

                    <!-- Gemini 3 Flash -->
                    <!--<div class="model-menu-item" data-model="gemini-3-flash"
                      onclick="selectModelFromMenu('gemini-3-flash', 'Gemini 3 Flash')">
                      <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                        fill="currentColor">
                        <path
                          d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm-40-82v-78q-33 0-56.5-23.5T360-320v-40L168-552q-3 18-5.5 36t-2.5 36q0 121 79.5 212T440-162Zm276-102q20-22 36-47.5t26.5-53q10.5-27.5 16-56.5t5.5-59q0-98-54.5-179T600-776v16q0 33-23.5 56.5T520-680h-80v80q0 17-11.5 28.5T400-560h-80v80h240q17 0 28.5 11.5T600-440v120h40q26 0 47 15.5t29 40.5Z" />
                      </svg>
                      <div class="model-menu-content">
                        <div class="model-menu-title">Gemini 3 Flash</div>
                      </div>
                    </div>

                    <div class="model-menu-divider"></div>-->

                    <!-- Qwen3-Omni-Flash 多模态模型 -->

                    <div class="model-menu-item" data-model="qwen3-omni-flash"
                      onclick="selectModelFromMenu('qwen3-omni-flash', 'Qwen3 Omni Flash')">
                      <svg class="model-menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"
                        fill="currentColor">
                        <path
                          d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm40-80h480L570-480 450-320l-90-120-120 160Zm-40 80v-560 560Z" />
                      </svg>
                      <div class="model-menu-content">
                        <div class="model-menu-title">Qwen3 Omni Flash</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
                  height="24" fill="currentColor">
                  <path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z" stroke-width="2" />
                </svg>
              </button>

              <button class="stop-btn" id="stopBtn" style="display: none;" onclick="stopGeneration()">
                <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
                  height="24" fill="currentColor">
                  <path d="M6 6h12v12H6z" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- Chat Flow 思维流工作区 -->
  <div class="chatflow-workspace" id="chatFlowWorkspace" style="display: none;">
    <!-- 返回按钮 -->
    <button class="chatflow-back-btn" onclick="closeChatFlow()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
      </svg>
      <span data-i18n="back-to-chat">返回对话</span>
    </button>

    <!-- 左侧 LLM 面板 - 嵌入 RAI 主界面 iframe -->
    <div class="chatflow-llm-panel" id="chatflowLLMPanel">
      <div class="chatflow-header">
        <h3 class="chatflow-title" id="chatflowTitle">新思维流</h3>
      </div>
      <!-- 嵌入 RAI 主界面，带 mode=chatflow 参数 -->
      <iframe id="chatflowIframe" class="chatflow-iframe" src="/?mode=chatflow" title="RAI Chat"
        allowfullscreen></iframe>
    </div>

    <!-- 可拖拽分隔栏 -->
    <div class="chatflow-divider" id="chatflowDivider"></div>

    <!-- 无限画布区域 -->
    <div class="chatflow-canvas-container" id="chatflowCanvasContainer">
      <svg class="infinite-canvas" id="infiniteCanvas">
        <defs>
          <!-- 点阵背景 pattern -->
          <pattern id="canvasGrid" width="40" height="40" patternUnits="userSpaceOnUse">
            <circle cx="20" cy="20" r="1.5" fill="rgba(255,255,255,0.06)" />
          </pattern>
        </defs>

        <!-- 背景层 -->
        <rect class="canvas-bg" width="20000" height="20000" x="-10000" y="-10000" fill="url(#canvasGrid)" />

        <!-- 可变换内容层 -->
        <g class="canvas-content" id="canvasContent">
          <!-- 连线层 (在节点下方) -->
          <g class="edges-layer" id="edgesLayer"></g>
          <!-- 节点层 -->
          <g class="nodes-layer" id="nodesLayer"></g>
          <!-- 连线预览 (在画布坐标系内) -->
          <line class="edge-preview-line" id="edgePreviewLine" x1="0" y1="0" x2="0" y2="0"
            stroke="var(--color-saturn-yellow)" stroke-width="2" stroke-dasharray="5,5" style="display: none;" />
        </g>
      </svg>

      <!-- 画布提示 -->
      <div class="canvas-hint" id="canvasHint">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="32" height="32" fill="currentColor">
          <path
            d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm280-80q-82 0-155-31.5T201-401q-51-58-82-131.5T80-688l80-32q31 113 127 186.5T520-460q137 0 233-73.5T880-720l80 32q-38 82-105.5 145.5T716-441q-71 41-154 61t-82 0Z" />
        </svg>
        <span>从左侧拖拽消息到画布，开始构建思维图谱</span>
      </div>

      <!-- 缩放控制 -->
      <div class="canvas-zoom-controls">
        <button class="canvas-zoom-btn" onclick="canvasZoomIn()" title="放大">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
          </svg>
        </button>
        <span class="canvas-zoom-level" id="canvasZoomLevel">100%</span>
        <button class="canvas-zoom-btn" onclick="canvasZoomOut()" title="缩小">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M19 13H5v-2h14v2z" />
          </svg>
        </button>
        <button class="canvas-zoom-btn" onclick="canvasResetView()" title="重置视图">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="18" height="18" fill="currentColor">
            <path
              d="M480-80q-75 0-140.5-28.5t-114-77q-48.5-48.5-77-114T120-440h80q0 117 81.5 198.5T480-160q117 0 198.5-81.5T760-440q0-117-81.5-198.5T480-720h-6l62 62-56 58-160-160 160-160 56 58-62 62h6q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-440q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T480-80Z" />
          </svg>
        </button>
      </div>

      <!-- 浮动工具栏 -->
      <div class="canvas-floating-toolbar" id="canvasFloatingToolbar">
        <!-- 选择工具 -->
        <button class="canvas-tool-btn active" data-tool="select" onclick="setCanvasTool('select')" title="选择">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M7 2l12 11.2-5.8.5 3.3 7.3-2.2 1-3.2-7.4L7 18.5V2z" />
          </svg>
        </button>

        <!-- 连线工具 -->
        <button class="canvas-tool-btn" data-tool="connect" onclick="setCanvasTool('connect')" title="连线">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="20" height="20" fill="currentColor">
            <path
              d="M440-80v-120H280q-33 0-56.5-23.5T200-280v-160h80v160h160v-120l160 160-160 160Zm200-400v-160H480v120L320-680l160-160v120h160q33 0 56.5 23.5T720-640v160h-80Z" />
          </svg>
        </button>

        <!-- 便签工具 -->
        <button class="canvas-tool-btn" data-tool="sticky" onclick="addStickyNote()" title="添加便签">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="20" height="20" fill="currentColor">
            <path
              d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v360L560-120H200Zm0-80h320v-240h240v-320H200v560Zm0 0v-560 560Z" />
          </svg>
        </button>

        <div class="canvas-tool-divider"></div>

        <!-- AI 拆解 -->
        <button class="canvas-tool-btn" data-tool="ai-decompose" onclick="aiDecomposeSelected()" title="AI 拆解">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="20" height="20" fill="currentColor">
            <path
              d="m354-247 126-76 126 77-33-144 111-96-146-13-58-136-58 135-146 13 111 97-33 143ZM233-80l65-281L80-550l288-25 112-265 112 265 288 25-218 189 65 281-247-149L233-80Z" />
          </svg>
        </button>

        <!-- 删除 -->
        <button class="canvas-tool-btn" data-tool="delete" onclick="deleteSelectedNodes()" title="删除选中">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
          </svg>
        </button>

        <div class="canvas-tool-divider"></div>

        <!-- 自动布局 -->
        <button class="canvas-tool-btn" data-tool="auto-layout" onclick="autoLayoutNodes()" title="自动布局">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="20" height="20" fill="currentColor">
            <path
              d="M120-520v-320h320v320H120Zm0 400v-320h320v320H120Zm400-400v-320h320v320H520Zm0 400v-320h320v320H520ZM200-600h160v-160H200v160Zm400 0h160v-160H600v160Zm0 400h160v-160H600v160Zm-400 0h160v-160H200v160Z" />
          </svg>
        </button>

        <!-- 导出 -->
        <button class="canvas-tool-btn" data-tool="export" onclick="toggleExportMenu()" title="导出">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" width="20" height="20" fill="currentColor">
            <path
              d="M480-320 280-520l56-58 104 104v-326h80v326l104-104 56 58-200 200ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z" />
          </svg>
        </button>

        <!-- 导出菜单 -->
        <div class="canvas-export-menu" id="canvasExportMenu">
          <div class="export-menu-item" onclick="exportCanvas('png')">
            <span>导出 PNG</span>
          </div>
          <div class="export-menu-item" onclick="exportCanvas('svg')">
            <span>导出 SVG</span>
          </div>
          <div class="export-menu-item" onclick="exportCanvas('mermaid')">
            <span>导出 Mermaid</span>
          </div>
          <div class="export-menu-item" onclick="exportCanvas('json')">
            <span>导出 JSON</span>
          </div>
        </div>
      </div>

      <!-- 拖放提示区域 -->
      <div class="canvas-drop-zone" id="canvasDropZone">
        <span class="canvas-drop-zone-text">释放以创建节点</span>
      </div>

    </div>
  </div>

  <!-- 对话索引导航器 -->
  <div class="chat-index-navigator" id="chatIndexNavigator">
    <!-- 上一个响应按钮 -->
    <button class="chat-index-nav-btn" id="chatIndexPrevBtn" onclick="navigateToResponse('prev')"
      onmouseenter="showNavTooltip(event, 'prev')" onmouseleave="hideNavTooltip()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
      </svg>
    </button>

    <!-- 时间轴 -->
    <div class="chat-index-timeline" id="chatIndexTimeline"></div>

    <!-- 下一个响应按钮 -->
    <button class="chat-index-nav-btn" id="chatIndexNextBtn" onclick="navigateToResponse('next')"
      onmouseenter="showNavTooltip(event, 'next')" onmouseleave="hideNavTooltip()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" />
      </svg>
    </button>
  </div>

  <!-- 对话索引导航提示框 -->
  <div class="chat-index-tooltip" id="chatIndexTooltip"></div>
  <div class="chat-index-nav-tooltip" id="chatIndexNavTooltip"></div>

  <!-- 设置面板 -->

  <div class="settings-modal" id="settingsModal">
    <div class="settings-content">
      <div class="settings-header">
        <h2 class="settings-title" data-i18n="settings">设置</h2>
        <button class="close-btn" onclick="closeSettings()">
          <svg class="material-symbols-outlined" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24"
            height="24" fill="currentColor">
            <path
              d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
          </svg>
        </button>
      </div>

      <div class="settings-body">
        <!-- 🎫 会员状态区域 -->
        <div class="settings-group" id="settingsMembershipSection">
          <h3 class="settings-group-title">🎫 会员状态</h3>
          <div class="settings-membership-section">
            <div class="settings-membership-header">
              <span class="settings-membership-badge free" id="settingsMembershipBadge">free</span>
              <span onclick="openMembershipPlans()" class="settings-upgrade-link">体验更多使用点数？</span>
            </div>
            <div class="settings-points-display">
              <span class="points-icon">⚡</span>
              <span>剩余点数: <strong id="settingsPointsDisplay">0</strong></span>
            </div>
            <button id="settingsCheckinBtn" onclick="userCheckin(); updateSettingsMembership();"
              class="settings-checkin-btn">
              签到 +20 ⚡
            </button>
            <div class="settings-created-at" id="settingsCreatedAt">创建于: -</div>
          </div>
        </div>

        <div class="settings-group">
          <h3 class="settings-group-title" data-i18n="appearance">外观</h3>

          <div class="setting-item">
            <label class="setting-label" data-i18n="theme-label">主题</label>
            <p class="setting-description" data-i18n="theme-desc">选择界面主题</p>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary" style="flex: 1;" onclick="setTheme('dark')">
                <span data-i18n="dark-theme">深色</span>
              </button>
              <button class="btn btn-secondary" style="flex: 1;" onclick="setTheme('light')">
                <span data-i18n="light-theme">浅色</span>
              </button>
            </div>
          </div>

          <div class="setting-item">
            <label class="setting-label" data-i18n="language-label">语言</label>
            <p class="setting-description" data-i18n="language-desc">选择界面语言</p>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary" style="flex: 1;" onclick="setLanguage('zh-CN')">
                <span>中文</span>
              </button>
              <button class="btn btn-secondary" style="flex: 1;" onclick="setLanguage('en')">
                <span>English</span>
              </button>
            </div>
          </div>
        </div>

        <div class="settings-group">
          <h3 class="settings-group-title" data-i18n="preferences-title">您有什么偏好？</h3>
          <div class="setting-item">
            <p class="setting-description" data-i18n="preferences-desc">设置AI的角色和行为</p>
            <textarea class="system-prompt-input" id="systemPrompt" rows="4"
              data-i18n-placeholder="preferences-placeholder" placeholder="例如: 我希望获得简短回复..."></textarea>
          </div>
        </div>

        <div class="settings-group">
          <div class="advanced-options-header" onclick="toggleAdvancedOptions()">
            <h3 class="settings-group-title" style="margin-bottom: 0;" data-i18n="advanced-options">高级选项</h3>
            <svg class="material-symbols-outlined advanced-options-icon" id="advancedOptionsIcon"
              xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
              <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" />
            </svg>
          </div>

          <div class="advanced-options-content" id="advancedOptionsContent">
            <div class="setting-item" style="margin-top: 16px;">
              <label class="setting-label">Temperature</label>
              <p class="setting-description" data-i18n="temperature-desc">控制回复的随机性 (0-2)</p>
              <div class="slider-container">
                <input type="range" class="slider-input" id="temperatureSlider" min="0" max="2" step="0.1" value="0.7"
                  oninput="updateSliderValue('temperature', this.value)">
                <span class="slider-value" id="temperatureValue">0.7</span>
              </div>
            </div>

            <div class="setting-item">
              <label class="setting-label">Top P</label>
              <p class="setting-description" data-i18n="topp-desc">核采样参数 (0-1)</p>
              <div class="slider-container">
                <input type="range" class="slider-input" id="topPSlider" min="0" max="1" step="0.05" value="0.9"
                  oninput="updateSliderValue('topP', this.value)">
                <span class="slider-value" id="topPValue">0.9</span>
              </div>
            </div>

            <div class="setting-item">
              <label class="setting-label">Max Tokens</label>
              <p class="setting-description" data-i18n="maxtokens-desc">最大生成长度 (100-8000)</p>
              <div class="slider-container">
                <input type="range" class="slider-input" id="maxTokensSlider" min="100" max="8000" step="100"
                  value="2000" oninput="updateSliderValue('maxTokens', this.value)">
                <span class="slider-value" id="maxTokensValue">2000</span>
              </div>
            </div>

            <div class="setting-item">
              <label class="setting-label">Frequency Penalty</label>
              <p class="setting-description" data-i18n="frequency-desc">频率惩罚 (仅DeepSeek)</p>
              <div class="slider-container">
                <input type="range" class="slider-input" id="frequencySlider" min="-2" max="2" step="0.1" value="0"
                  oninput="updateSliderValue('frequency', this.value)">
                <span class="slider-value" id="frequencyValue">0</span>
              </div>
            </div>

            <div class="setting-item">
              <label class="setting-label">Presence Penalty</label>
              <p class="setting-description" data-i18n="presence-desc">存在惩罚 (仅DeepSeek)</p>
              <div class="slider-container">
                <input type="range" class="slider-input" id="presenceSlider" min="-2" max="2" step="0.1" value="0"
                  oninput="updateSliderValue('presence', this.value)">
                <span class="slider-value" id="presenceValue">0</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="settings-footer">
        <button class="btn btn-danger" onclick="handleLogout()" data-i18n="logout"
          style="margin-right: auto;">退出登录</button>
        <button class="btn btn-secondary" onclick="closeSettings()" data-i18n="cancel">取消</button>
        <button class="btn btn-primary" onclick="saveSettings()" data-i18n="save-settings">保存设置</button>
      </div>
    </div>
  </div>

  <!-- 模型选择弹窗 -->
  <div class="model-modal" id="modelModal">
    <div class="model-modal-content">
      <div class="model-modal-header">
        <div class="model-modal-title">选择模型</div>
        <button class="model-modal-close" onclick="closeModelModal()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
            <path
              d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
          </svg>
        </button>
      </div>
      <div class="model-modal-body">
        <!-- 自动选择 -->
        <div class="model-card selected" data-model="auto" onclick="selectModelFromModal('auto', '自动选择')">
          <svg class="model-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
            <path
              d="m280-40 123-622q6-29 27-43.5t44-14.5q23 0 42.5 10t31.5 30l40 64q18 29 46.5 44.5T700-556q54 5 108.5 14t106.5 25l-124 557q-4 17-17.5 28.5T744-920h-14q-18 0-31.5-11.5T681-961l-89-280q-2-8-9-13.5t-15-5.5q-8 0-14.5 5t-8.5 13l-89 280q-4 17-17 28.5T408-920h-14q-17 0-30-11.5T347-961L280-40Z" />
          </svg>
          <div class="model-label">自动选择</div>
          <div class="model-description">智能路由</div>
        </div>

        <!-- 极速模式 -->
        <div class="model-card" data-model="qwen-flash" onclick="selectModelFromModal('qwen-flash', '极速模式')">
          <svg class="model-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
            <path d="m280-80 160-300-320-40 480-460h80L520-580l320 40L360-80h-80Z" />
          </svg>
          <div class="model-label">极速模式</div>
          <div class="model-description">Qwen Flash</div>
        </div>

        <!-- Plus模式 -->
        <div class="model-card" data-model="qwen-plus" onclick="selectModelFromModal('qwen-plus', 'Plus')">
          <svg class="model-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
            <path d="M479-160 280-360l51-52 148 148 318-318 51 52-369 370Z" />
          </svg>
          <div class="model-label">Plus</div>
          <div class="model-description">Qwen Plus</div>
        </div>

        <!-- 专家模式 -->
        <div class="model-card" data-model="qwen-max" onclick="selectModelFromModal('qwen-max', '专家模式')">
          <svg class="model-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
            <path
              d="M240-80v-172q-57-52-88.5-121.5T120-520q0-150 105-255t255-105q125 0 221.5 73.5T827-615l52 205q5 19-7 34.5T840-360h-80v120q0 33-23.5 56.5T680-160h-80v80h-80v-160h160v-200h108l-38-155q-23-91-98-148t-172-57q-116 0-198 81t-82 197q0 60 24.5 114t69.5 96l26 24v208h-80Zm254-360Zm-54 80h80l6-50q8-3 14.5-7t11.5-9l46 20 40-68-40-30q2-8 2-16t-2-16l40-30-40-68-46 20q-5-5-11.5-9t-14.5-7l-6-50h-80l-6 50q-8 3-14.5 7t-11.5 9l-46-20-40 68 40 30q-2 8-2 16t2 16l-40 30 40 68 46-20q5 5 11.5 9t14.5 7l6 50Zm40-100q-25 0-42.5-17.5T420-520q0-25 17.5-42.5T480-580q25 0 42.5 17.5T540-520q0 25-17.5 42.5T480-460Z" />
          </svg>
          <div class="model-label">专家模式</div>
          <div class="model-description">Qwen Max</div>
        </div>

        <!-- DeepSeek V3 -->
        <div class="model-card" data-model="deepseek-v3" onclick="selectModelFromModal('deepseek-v3', 'DeepSeek V3')">
          <svg class="model-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
            <path
              d="M320-280q17 0 28.5-11.5T360-320q0-17-11.5-28.5T320-360q-17 0-28.5 11.5T280-320q0 17 11.5 28.5T320-280Zm0-160q17 0 28.5-11.5T360-480q0-17-11.5-28.5T320-520q-17 0-28.5 11.5T280-480q0 17 11.5 28.5T320-440Zm0-160q17 0 28.5-11.5T360-640q0-17-11.5-28.5T320-680q-17 0-28.5 11.5T280-640q0 17 11.5 28.5T320-600Zm120 320h240v-80H440v80Zm0-160h240v-80H440v80Zm0-160h240v-80H440v80ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z" />
          </svg>
          <div class="model-label">DeepSeek V3</div>
          <div class="model-description">深度推理</div>
        </div>

        <!-- DeepSeek Speciale 已隐藏 (临时模型已过期) -->

        <!-- 文档理解 -->
        <div class="model-card" data-model="qwen-long" onclick="selectModelFromModal('qwen-long', '文档理解')">
          <svg class="model-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
            <path
              d="M320-240h320v-80H320v80Zm0-160h320v-80H320v80ZM240-80q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80H240Zm280-560v-200H240v640h480v-440H520ZM240-840v200-200 640-640Z" />
          </svg>
          <div class="model-label">文档理解</div>
          <div class="model-description">Qwen Long</div>
        </div>

        <!-- 视频理解 -->
        <div class="model-card" data-model="qwen-vl-max-latest"
          onclick="selectModelFromModal('qwen-vl-max-latest', '视频理解')">
          <svg class="model-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
            <path
              d="m380-300 280-180-280-180v360ZM160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h480q33 0 56.5 23.5T720-720v180l160-160v440L720-420v180q0 33-23.5 56.5T640-160H160Zm0-80h480v-480H160v480Zm0 0v-480 480Z" />
          </svg>
          <div class="model-label">视频理解</div>
          <div class="model-description">Qwen VL Max</div>
        </div>

        <!-- LMStudio Local -->
        <div class="model-card" data-model="lmstudio-local" onclick="selectModelFromModal('lmstudio-local', '本地模型')">
          <svg class="model-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor">
            <path
              d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-80q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm0-80q66 0 113-47t47-113q0-66-47-113t-113-47q-66 0-113 47t-47 113q0 66 47 113t113 47Zm0-80q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Z" />
          </svg>
          <div class="model-label">本地模型</div>
          <div class="model-description">LMStudio</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 重新生成弹窗 -->
  <div class="regenerate-modal" id="regenerateModal">
    <div class="regenerate-modal-content">
      <h3 id="regenerateModalTitle" data-i18n="regenerateTitle">重新生成回复</h3>

      <div class="regenerate-option">
        <label data-i18n="selectModel">选择模型</label>
        <select id="regenerateModelSelect">
          <option value="auto" data-i18n="smartMode">最佳</option>
          <option value="qwen-flash" data-i18n="fastMode">极速</option>
          <option value="deepseek-v3" data-i18n="expertMode">专家</option>
          <option value="qwen-plus">Qwen Plus</option>
          <option value="qwen-max">Qwen Max</option>
        </select>
      </div>

      <div class="regenerate-option">
        <label data-i18n="internetSearch">联网搜索</label>
        <label class="toggle-switch">
          <input type="checkbox" id="regenerateInternetToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="regenerate-option">
        <label data-i18n="thinkingMode">思考模式</label>
        <label class="toggle-switch">
          <input type="checkbox" id="regenerateThinkingToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="regenerate-modal-actions">
        <button class="regenerate-cancel-btn" onclick="closeRegenerateModal()" data-i18n="cancel">取消</button>
        <button class="regenerate-confirm-btn" onclick="confirmRegenerate()" data-i18n="regenerate">重新生成</button>
      </div>
    </div>
  </div>

  <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelected(event)">

  <!-- 粒子背景画布 -->
  <canvas id="particleCanvas"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;"></canvas>

  <!-- 外部脚本 -->
  <script src="app.js"></script>
</body>

</html>
